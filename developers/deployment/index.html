<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Deployment - STABILA Documentation</title>
  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Deployment";
    var mkdocs_page_input_path = "developers/deployment.md";
    var mkdocs_page_url = "/documentation-en/developers/deployment/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> STABILA Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Introduction</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../introduction/">Repository</a>
                </li>
                <li class="">
                    
    <a class="" href="../../introduction/dpos/">DPoS</a>
                </li>
                <li class="">
                    
    <a class="" href="../../introduction/overview/">Overview</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">API</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../api/http/">HTTP API</a>
                </li>
                <li class="">
                    
    <a class="" href="../../api/rpc/">RPC API</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Mechanism & Algorithm</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../mechanism-algorithm/gov/">GOV and Committee</a>
                </li>
                <li class="">
                    
    <a class="" href="../../mechanism-algorithm/src10/">SRC-10</a>
                </li>
                <li class="">
                    
    <a class="" href="../../mechanism-algorithm/account/">Account Model</a>
                </li>
                <li class="">
                    
    <a class="" href="../../mechanism-algorithm/resource/">Resource Model</a>
                </li>
                <li class="">
                    
    <a class="" href="../../mechanism-algorithm/dex/">Decentralized Exchange</a>
                </li>
                <li class="">
                    
    <a class="" href="../../mechanism-algorithm/multi-signatures/">Multi-Signature</a>
                </li>
                <li class="">
                    
    <a class="" href="../../mechanism-algorithm/shielded-SRC20-contract/">Shielded SRC20 Contract</a>
                </li>
                <li class="">
                    
    <a class="" href="../../mechanism-algorithm/system-contracts/">System Contracts</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Architecture</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../architecture/network/">Network</a>
                </li>
                <li class="">
                    
    <a class="" href="../../architecture/database/">Database</a>
                </li>
                <li class="">
                    
    <a class="" href="../../architecture/event/">Event Subsystem</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Smart Contract</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../contracts/svm/">SVM</a>
                </li>
                <li class="">
                    
    <a class="" href="../../contracts/compiler/">Compiler</a>
                </li>
                <li class="">
                    
    <a class="" href="../../contracts/contract/">Contract</a>
                </li>
                <li class="">
                    
    <a class="" href="../../contracts/src20/">SRC-20</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Developers</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../official-public-nodes/">Official Public Nodes</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Deployment</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#deployment">Deployment</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#premise">Premise</a></li>
        
            <li><a class="toctree-l4" href="#deployment-guide">Deployment Guide</a></li>
        
            <li><a class="toctree-l4" href="#logging-and-network-connection-verification">Logging and Network Connection Verification</a></li>
        
            <li><a class="toctree-l4" href="#stop-node-gracefully">Stop Node Gracefully</a></li>
        
            <li><a class="toctree-l4" href="#fullnode-fast-deployment">FullNode Fast Deployment</a></li>
        
            <li><a class="toctree-l4" href="#grpc-gateway-deployment">Grpc Gateway Deployment</a></li>
        
            <li><a class="toctree-l4" href="#event-subscribe-plugin-deployment">Event Subscribe plugin Deployment</a></li>
        
            <li><a class="toctree-l4" href="#advanced-configurations">Advanced Configurations</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../run-in-idea/">Run FullNode in IDEA</a>
                </li>
                <li class="">
                    
    <a class="" href="../litefullnode/">Run Lite FullNode</a>
                </li>
                <li class="">
                    
    <a class="" href="../resources/">Resources</a>
                </li>
                <li class="">
                    
    <a class="" href="../contribution/">Contribution</a>
                </li>
                <li class="">
                    
    <a class="" href="../java-stabila/">Java-Stabila</a>
                </li>
                <li class="">
                    
    <a class="" href="../advanced-configuration/">Advanced Configuration</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Clients</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../clients/wallet-cli/">Wallet-cli</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Releases</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../releases/">Binary Integrity Check</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../faq/">FAQ</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../glossary/">Glossary</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">STABILA Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Developers &raquo;</li>
        
      
    
    <li>Deployment</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/stabilaprotocol/documentation-en/edit/master/docs/developers/deployment.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="deployment">Deployment<a class="headerlink" href="#deployment" title="Permanent link">&para;</a></h1>
<h2 id="premise">Premise<a class="headerlink" href="#premise" title="Permanent link">&para;</a></h2>
<p>Create a folder for fullnode.</p>
<p>Clone the latest master branch of <a href="https://github.com/stabilaprotocol/java-stabila">https://github.com/stabilaprotocol/java-stabila</a> and extract it to</p>
<div class="codehilite"><pre><span></span>/deploy/java-stabila
</pre></div>


<p>Make sure you have the proper dependencies.</p>
<ul>
<li>JDK 1.8 (JDK 1.9+ is not supported yet)</li>
<li>On Linux Ubuntu system (e.g. Ubuntu 16.04.4 LTS), ensure that the machine has <a href="https://www.digitalocean.com/community/tutorials/how-to-install-java-with-apt-get-on-ubuntu-16-04"><strong>Oracle JDK 8</strong></a>, instead of having <strong>Open JDK 8</strong> in the system. If you are building the source code by using <strong>Open JDK 8</strong>, you will get "Build Failed" result.</li>
<li>Open <strong>UDP</strong> ports for connection to the network</li>
<li><strong>MINIMUM</strong> 2 CPU Cores</li>
</ul>
<h2 id="deployment-guide">Deployment Guide<a class="headerlink" href="#deployment-guide" title="Permanent link">&para;</a></h2>
<p>1.&nbsp;Build the java-stabila project</p>
<div class="codehilite"><pre><span></span>cd /deploy/java-stabila
./gradlew build
</pre></div>


<p>2.&nbsp;Copy the FullNode.jar along with configuration files into the respective directories</p>
<div class="codehilite"><pre><span></span>download your needed configuration file from https://github.com/stabilaprotocol/stabila-deployment.

main_net_config.conf is the configuration for MainNet.

please rename the configuration file to `config.conf` and use this config.conf to start FullNode.

cp build/libs/FullNode.jar ../fullnode
</pre></div>


<p>3.&nbsp;You can now run your FullNode using the following command</p>
<div class="codehilite"><pre><span></span>java -jar FullNode.jar -c config.conf // make sure that your config.conf is downloaded from https://github.com/stabilaprotocol/stabila-deployment
</pre></div>


<p>4.&nbsp;Running a Governor Node for mainnet</p>
<div class="codehilite"><pre><span></span>java -jar FullNode.jar -p your private key --executive -c your config.conf(Example：/data/java-stabila/config.conf)
Example:
java -jar FullNode.jar -p 650950B193DDDDB35B6E48912DD28F7AB0E7140C1BFDEFD493348F02295BD812 --executive -c /data/java-stabila/config.conf
</pre></div>


<p>5.&nbsp;Running a Governor Node</p>
<p>You should modify the config.conf:</p>
<ul>
<li>Replace existing entry in genesis.block.executives with your address</li>
<li>Replace existing entry in seed.node ip.list with your ip list</li>
<li>The first Governor Node start, needSyncCheck should be set false</li>
<li>Set p2pversion to 61</li>
</ul>
<div class="codehilite"><pre><span></span>cd build/libs
java -jar FullNode.jar -p your private key --executive -c your config.conf (Example：/data/java-stabila/config.conf)
Example:
java -jar FullNode.jar -p 650950B193DDDDB35B6E48912DD28F7AB0E7140C1BFDEFD493348F02295BD812 --executive -c /data/java-stabila/config.conf
</pre></div>


<h2 id="logging-and-network-connection-verification">Logging and Network Connection Verification<a class="headerlink" href="#logging-and-network-connection-verification" title="Permanent link">&para;</a></h2>
<p>Logs for both nodes are located in <code>/deploy/\*/logs/stabila.log</code>. Use <code>tail -f /logs/stabila.log/</code> to follow along with the block syncing.</p>
<p>You should see something similar to this in your logs for block synchronization:</p>
<p><strong>FullNode</strong></p>
<div class="codehilite"><pre><span></span>12:00:57.658 INFO  [pool-7-thread-1] [o.t.c.n.n.NodeImpl](NodeImpl.java:830) Success handle block Num:236610,ID:0000000000039c427569efa27cc2493c1fff243cc1515aa6665c617c45d2e1bf
</pre></div>


<h2 id="stop-node-gracefully">Stop Node Gracefully<a class="headerlink" href="#stop-node-gracefully" title="Permanent link">&para;</a></h2>
<p>Create file stop.sh，use kill -15 to close FullNode.jar.
You need to modify pid=<code>ps -ef |grep FullNode.jar |grep -v grep |awk '{print $2}'</code> to find the correct pid.</p>
<div class="codehilite"><pre><span></span>#!/bin/bash
while true; do
  pid=`ps -ef |grep FullNode.jar |grep -v grep |awk &#39;{print $2}&#39;`
  if [ -n &quot;$pid&quot; ]; then
    kill -15 $pid
    echo &quot;The java-stabila process is exiting, it may take some time, forcing the exit may cause damage to the database, please wait patiently...&quot;
    sleep 1
  else
    echo &quot;java-stabila killed successfully!&quot;
    break
  fi
done
</pre></div>


<h2 id="fullnode-fast-deployment">FullNode Fast Deployment<a class="headerlink" href="#fullnode-fast-deployment" title="Permanent link">&para;</a></h2>
<p>Download fast deployment script, run the script according to different types of node.</p>
<h3>Scope of use</h3>

<p>This script could be used on Linux/MacOS, but not on Windows.
Supported just by FullNode.</p>
<h3>Download and run script</h3>

<div class="codehilite"><pre><span></span>wget https://github.com/stabilaprotocol/stabila-deployment/blob/master/deploy_stabila.sh -O deploy_stabila.sh
</pre></div>


<h3>Parameter Illustration</h3>

<div class="codehilite"><pre><span></span>bash deploy_stabila.sh --app <span class="o">[</span>FullNode<span class="o">]</span> --net <span class="o">[</span>mainnet<span class="o">]</span> --db <span class="o">[</span>keep<span class="p">|</span>remove<span class="p">|</span>backup<span class="o">]</span> --heap-size &lt;heapsize&gt;

--app Optional, Running application. The default node is Fullnode.
--net Optional, Connecting network. The default network is mainnet and it could be mainnet, testnet.
--db  Optional, The way of data processing could be keep, remove and backup. Default is keep. If you launch two different networks, like from mainnet to testnet or from testnet to mainnet, you need to delete database.
--rpc-port  Optional, Port of grpc. Default is <span class="m">50051</span>.
--commit  Optional, commitid of project.
--branch  Optional, branch of project.  Mainnet default is latest release and Testnet default is master.
--heap-size  Optional, jvm option: Xmx. The default heap-size is <span class="m">0</span>.8 * memory size.
--work_space  Optional, default is current directory.
</pre></div>


<h3> Deployment of FullNode on the one host </h3>

<div class="codehilite"><pre><span></span>wget https://raw.githubusercontent.com/stabilaprotocol/StabilaDeployment/master/deploy_stabila.sh -O deploy_stabila.sh
bash deploy_stabila.sh
</pre></div>


<h2 id="grpc-gateway-deployment">Grpc Gateway Deployment<a class="headerlink" href="#grpc-gateway-deployment" title="Permanent link">&para;</a></h2>
<h3> Summary </h3>

<p>This script helps you download the code from https://github.com/stabilaprotocol/grpc-gateway and deploy the code on your environment.</p>
<h3> Pre-requests </h3>

<p>Please follow the guide on https://github.com/stabilaprotocol/grpc-gateway
Install Golang, Protoc, and set $GOPATH environment variable according to your requirement.</p>
<h3> Download and run script </h3>

<div class="codehilite"><pre><span></span>wget https://github.com/stabilaprotocol/stabila-deployment/blob/master/deploy_grpc_gateway.sh -O deploy_grpc_gateway.sh
</pre></div>


<h3> Parameter Illustration </h3>

<div class="codehilite"><pre><span></span>bash deploy_grpc_gateway.sh --rpchost <span class="o">[</span>rpc host ip<span class="o">]</span> --rpcport <span class="o">[</span>rpc port number<span class="o">]</span> --httpport <span class="o">[</span>http port number<span class="o">]</span>

--rpchost The fullnode IP where the grpc service is provided. Default value is <span class="s2">&quot;localhost&quot;</span>.
--rpcport The fullnode port number grpc service is consuming. Default value is <span class="m">50051</span>.
--httpport The port intends to provide http service provided by grpc gateway. Default value is <span class="m">18890</span>.
</pre></div>


<h3> Example </h3>

<p>Use default configuration：</p>
<div class="codehilite"><pre><span></span>bash deploy_grpc_gateway.sh
</pre></div>


<p>Use customized configuration：</p>
<div class="codehilite"><pre><span></span>bash deploy_grpc_gateway.sh --rpchost <span class="m">127</span>.0.0.1 --rpcport <span class="m">50052</span> --httpport <span class="m">18891</span>
</pre></div>


<h2 id="event-subscribe-plugin-deployment">Event Subscribe plugin Deployment<a class="headerlink" href="#event-subscribe-plugin-deployment" title="Permanent link">&para;</a></h2>
<p>This is an implementation of Stabila eventsubscribe model.</p>
<ul>
<li><strong>api</strong> module defines IPluginEventListener, a protocol between Java-stabila and event plugin.</li>
<li><strong>app</strong> module is an example for loading plugin, developers could use it for debugging.</li>
<li><strong>kafkaplugin</strong> module is the implementation for kafka, it implements IPluginEventListener, it receives events subscribed from Java-stabila and relay events to kafka server.</li>
<li><strong>mongodbplugin</strong> mongodbplugin module is the implementation for mongodb.</li>
</ul>
<h3> Setup/Build </h3>

<ol>
<li>Clone the repo <code>git clone https://github.com/stabilaprotocol/event-plugin.git</code></li>
<li>Go to eventplugin <code>cd event-plugin</code></li>
<li>
<p>run <code>./gradlew build</code></p>
</li>
<li>
<p>This will produce one plugin zip, named <code>plugin-kafka-1.0.0.zip</code>, located in the <code>event-plugin/build/plugins/</code> directory.</p>
</li>
</ol>
<h3> Edit **config.conf** of Java-stabila， add the following fileds:</h3>

<div class="codehilite"><pre><span></span>event.subscribe = {
    path = &quot;&quot; // absolute path of plugin
    server = &quot;&quot; // target server address to receive event triggers
    dbconfig=&quot;&quot; // dbname|username|password
    topics = [
        {
          triggerName = &quot;block&quot; // block trigger, the value can&#39;t be modified
          enable = false
          topic = &quot;block&quot; // plugin topic, the value could be modified
        },
        {
          triggerName = &quot;transaction&quot;
          enable = false
          topic = &quot;transaction&quot;
        },
        {
          triggerName = &quot;contractevent&quot;
          enable = true
          topic = &quot;contractevent&quot;
        },
        {
          triggerName = &quot;contractlog&quot;
          enable = true
          topic = &quot;contractlog&quot;
        }
    ]

    filter = {
       fromblock = &quot;&quot; // the value could be &quot;&quot;, &quot;earliest&quot; or a specified block number as the beginning of the queried range
       toblock = &quot;&quot; // the value could be &quot;&quot;, &quot;latest&quot; or a specified block number as end of the queried range
       contractAddress = [
           &quot;&quot; // contract address you want to subscribe, if it&#39;s set to &quot;&quot;, you will receive contract logs/events with any contract address.
       ]

       contractTopic = [
           &quot;&quot; // contract topic you want to subscribe, if it&#39;s set to &quot;&quot;, you will receive contract logs/events with any contract topic.
       ]
    }
}
</pre></div>


<ul>
<li><strong>path</strong>: is the absolute path of "plugin-kafka-1.0.0.zip"</li>
<li><strong>server</strong>: Kafka server address</li>
<li><strong>topics</strong>: each event type maps to one Kafka topic, we support four event types subscribing, block, transaction, contractlog and contractevent.</li>
<li><strong>dbconfig</strong>: db configuration information for mongodb, if using kafka, delete this one; if using Mongodb, add like that dbname|username|password</li>
<li><strong>triggerName</strong>: the trigger type, the value can't be modified.</li>
<li><strong>enable</strong>: plugin can receive nothing if the value is false.</li>
<li><strong>topic</strong>: the value is the kafka topic to receive events. Make sure it has been created and Kafka process is running</li>
<li><strong>filter</strong>: filter condition for process trigger.
 <strong>note</strong>: if the server is not 127.0.0.1, pls set some properties in config/server.properties file
           remove comment and set listeners=PLAINTEXT://:9092
           remove comment and set advertised.listeners to PLAINTEXT://host_ip:9092</li>
</ul>
<h3 id="kafka"> Install Kafka </h3>

<p><strong>On Mac</strong>:</p>
<div class="codehilite"><pre><span></span>brew install kafka
</pre></div>


<p><strong>On Linux</strong>:</p>
<div class="codehilite"><pre><span></span>cd /usr/local
wget http://archive.apache.org/dist/kafka/0.10.2.2/kafka_2.10-0.10.2.2.tgz
tar -xzvf kafka_2.10-0.10.2.2.tgz
mv kafka_2.10-0.10.2.2 kafka

add &quot;export PATH=$PATH:/usr/local/kafka/bin&quot; to end of /etc/profile
source /etc/profile


kafka-server-start.sh /usr/local/kafka/config/server.properties &amp;
</pre></div>


<p><strong>Note</strong>: make sure the version of Kafka is the same as the version set in build.gradle of eventplugin project.(kafka_2.10-0.10.2.2 kafka)</p>
<h3> Run Kafka </h3>

<p><strong>On Mac</strong>:</p>
<div class="codehilite"><pre><span></span>zookeeper-server-start /usr/local/etc/kafka/zookeeper.properties &amp; kafka-server-start /usr/local/etc/kafka/server.properties
</pre></div>


<p><strong>On Linux</strong>:</p>
<div class="codehilite"><pre><span></span>zookeeper-server-start.sh /usr/local/kafka/config/zookeeper.properties &amp;
Sleep about 3 seconds
kafka-server-start.sh /usr/local/kafka/config/server.properties &amp;
</pre></div>


<h3> Create topics to receive events, the topic is defined in config.conf </h3>

<p><strong>On Mac</strong>:</p>
<div class="codehilite"><pre><span></span>kafka-topics --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic block
kafka-topics --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic transaction
kafka-topics --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic contractlog
kafka-topics --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic contractevent
</pre></div>


<p><strong>On Linux</strong>:</p>
<div class="codehilite"><pre><span></span>kafka-topics.sh  --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic block
kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic transaction
kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic contractlog
kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic contractevent
</pre></div>


<h3> Kafka consumer </h3>

<p><strong>On Mac</strong>:</p>
<div class="codehilite"><pre><span></span>kafka-console-consumer --bootstrap-server localhost:9092  --topic block
kafka-console-consumer --bootstrap-server localhost:9092  --topic transaction
kafka-console-consumer --bootstrap-server localhost:9092  --topic contractlog
kafka-console-consumer --bootstrap-server localhost:9092  --topic contractevent
</pre></div>


<p><strong>On Linux</strong>:</p>
<div class="codehilite"><pre><span></span>kafka-console-consumer.sh --zookeeper localhost:2181 --topic block
kafka-console-consumer.sh --zookeeper localhost:2181 --topic transaction
kafka-console-consumer.sh --zookeeper localhost:2181 --topic contractlog
kafka-console-consumer.sh --zookeeper localhost:2181 --topic contractevent
</pre></div>


<h3> Load plugin in Java-stabila </h3>

<ul>
<li>add --es to command line, for example:</li>
</ul>
<div class="codehilite"><pre><span></span> java -jar FullNode.jar -p privatekey -c config.conf --es
</pre></div>


<h3> Event filter </h3>

<p>which is defined in config.conf, path: event.subscribe</p>
<div class="codehilite"><pre><span></span>filter = {
       fromblock = &quot;&quot; // the value could be &quot;&quot;, &quot;earliest&quot; or a specified block number as the beginning of the queried range
       toblock = &quot;&quot; // the value could be &quot;&quot;, &quot;latest&quot; or a specified block number as end of the queried range
       contractAddress = [
           &quot;SVkNuE1BYxECWq85d8UR9zsv6WppBns9iH&quot; // contract address you want to subscribe, if it&#39;s set to &quot;&quot;, you will receive contract logs/events with any contract address.
       ]

       contractTopic = [
           &quot;f0f1e23ddce8a520eaa7502e02fa767cb24152e9a86a4bf02529637c4e57504b&quot; // contract topic you want to subscribe, if it&#39;s set to &quot;&quot;, you will receive contract logs/events with any contract topic.
       ]
    }
</pre></div>


<h3 id="mongo"> Download and install MongoDB </h3>

<p><strong> Suggested Configuration </strong></p>
<ul>
<li>CPU/ RAM: 16Core / 32G</li>
<li>DISK: 500G</li>
<li>System: CentOS 64</li>
</ul>
<p>The version of MongoDB is <strong>4.0.4</strong>, below is the command:</p>
<ul>
<li>cd /home/java-stabila</li>
<li>curl -O https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-4.0.4.tgz</li>
<li>tar zxvf mongodb-linux-x86_64-4.0.4.tgz</li>
<li>mv mongodb-linux-x86_64-4.0.4 mongodb</li>
</ul>
<p><strong> Set environment </strong>
- export MONGOPATH=/home/java-stabila/mongodb/
- export PATH=$PATH:$MONGOPATH/bin</p>
<p><strong> Create mongodb config </strong>
The path is : /etc/mongodb/mgdb.conf</p>
<ul>
<li>cd /etc/mongodb</li>
<li>touch mgdb.conf</li>
</ul>
<p>Create data&amp;log folder for mongodb
Create data, log subfolder in mongodb directory,  and add their absolute path to mgdb.conf</p>
<p><strong> Example: </strong></p>
<ul>
<li>dbpath=/home/java-stabila/mongodb/data</li>
<li>logpath=/home/java-stabila/mongodb/log/mongodb.log</li>
<li>port=27017</li>
<li>logappend=true</li>
<li>fork=true</li>
<li>bind_ip=0.0.0.0</li>
<li>auth=true</li>
<li>wiredTigerCacheSizeGB=2</li>
</ul>
<p><strong> Note: </strong>
- bind_ip must be configured to 0.0.0.0，otherwise remote connection will be refused.
- wiredTigerCacheSizeGB, must be configured to prevent OOM</p>
<p><strong> Launch MongoDB </strong>
  - mongod  --config /etc/mongodb/mgdb.conf</p>
<p><strong> Create admin account: </strong>
- mongo
- use admin
- db.createUser({user:"root",pwd:"admin",roles:[{role:"root",db:"admin"}]})</p>
<p><strong> Create eventlog and its owner account </strong></p>
<ul>
<li>db.auth("root", "admin")</li>
<li>use eventlog</li>
<li>db.createUser({user:"stabila",pwd:"123456",roles:[{role:"dbOwner",db:"eventlog"}]})</li>
</ul>
<blockquote>
<p>database: eventlog, username: stabila, password: 123456</p>
</blockquote>
<p><strong> Firewall rule: </strong>
- iptables -A INPUT -p tcp -m state --state NEW -m tcp --dport 27017 -j ACCEPT</p>
<p><strong> Remote connection via mongo: </strong></p>
<ul>
<li>mongo 47.90.245.68:27017</li>
<li>use eventlog</li>
<li>db.auth("stabila", "123456")</li>
<li>show collections</li>
<li>db.block.find()</li>
</ul>
<p><strong> Query block trigger data: </strong></p>
<ul>
<li>db.block.find({blockNumber: {$lt: 1000}});  // return records whose blockNumber less than1000</li>
</ul>
<p><strong> Set database index to speedup query: </strong></p>
<p>cd /{projectPath}
sh insertIndex.sh</p>
<h2 id="advanced-configurations">Advanced Configurations<a class="headerlink" href="#advanced-configurations" title="Permanent link">&para;</a></h2>
<p>Read the <a href="../advanced-configuration/">Advanced Configuration</a></p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../run-in-idea/" class="btn btn-neutral float-right" title="Run FullNode in IDEA">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../official-public-nodes/" class="btn btn-neutral" title="Official Public Nodes"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/stabilaprotocol/documentation-en/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../official-public-nodes/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../run-in-idea/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
      <script src="../../search/main.js" defer></script>

</body>
</html>
